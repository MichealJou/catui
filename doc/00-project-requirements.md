# CatUI 项目需求文档

> **版本**: 1.0.0
> **创建日期**: 2026-02-11
> **项目状态**: 第一阶段重构完成，第二阶段规划中

---

## 📋 项目概述

### 项目名称
**CatUI** - Canvas Table User Interface

### 项目定位
一个基于 Vue 3 + TypeScript 的高性能 Canvas 表格组件库，支持百万级数据渲染。

### 核心价值主张
- 🚀 **极致性能** - 支持 100 万+ 数据流畅滚动
- 🎨 **多框架兼容** - Ant Design Vue / Element Plus / NaiveUI 主题
- 🔌 **API 兼容** - 完全兼容 Ant Design Vue Table API
- 🧩 **插件化架构** - 灵活扩展，按需加载

---

## 🎯 项目目标

### 主要目标

#### 1. 性能目标
| 指标 | 目标值 | 当前状态 |
|------|--------|----------|
| 数据量支持 | 100 万行 | ✅ 已实现（虚拟滚动） |
| 初始渲染时间 | < 500ms | ✅ 已实现 |
| 滚动帧率 | 60 FPS | ✅ 已实现 |
| 内存占用 | < 100MB | ✅ 已优化 |

#### 2. 功能目标
| 功能模块 | 状态 | 完成度 |
|----------|------|--------|
| 基础表格渲染 | ✅ 完成 | 100% |
| 虚拟滚动 | ✅ 完成 | 100% |
| 排序功能 | ✅ 完成 | 100% |
| 筛选功能 | ✅ 完成 | 100% |
| 行选择（单/多） | ✅ 完成 | 100% |
| 分页功能 | ✅ 完成 | 100% |
| 固定列 | ⏳ 待实现 | 0% |
| 树形数据 | ✅ 完成 | 80% |
| 展开行 | ✅ 完成 | 90% |
| 单元格编辑 | ⏳ 待实现 | 0% |
| 拖拽排序 | ⏳ 待实现 | 0% |

#### 3. 兼容性目标
| 框架/库 | 兼容性 | 状态 |
|---------|---------|------|
| Ant Design Vue | API 完全兼容 | 🔄 进行中 90% |
| Element Plus | 主题支持 | ✅ 完成 |
| NaiveUI | 主题支持 | ✅ 完成 |

---

## 🏗️ 技术架构

### 技术栈
```
前端框架: Vue 3.3+ (Composition API)
开发语言: TypeScript 5.3
构建工具: Vite 5.0
渲染引擎: @antv/g2 5.x (Canvas)
样式方案: Less + UnoCSS
包管理: pnpm (Monorepo)
```

### 核心模块
```
packages/ctable/
├── components/      # Vue 组件
│   ├── CTable.vue           # 主表格组件
│   └── CPagination.vue      # 分页组件
├── core/             # 核心逻辑
│   ├── RendererState.ts     # 渲染器状态基类
│   ├── G2TableRenderer.ts   # G2 渲染器
│   ├── VirtualScroll.ts     # 虚拟滚动
│   ├── FilterManager.ts     # 筛选管理
│   ├── SortManager.ts       # 排序管理
│   └── ThemeManager.ts      # 主题管理
├── adapters/        # 组件适配器
│   ├── AdapterFactory.ts
│   ├── DefaultPaginationAdapter.ts
│   └── AntDesignVuePaginationAdapter.ts
├── renderers/       # 渲染器
│   └── CheckboxRenderer.ts
├── theme/           # 主题系统
│   └── presets/
│       ├── ant-design.ts
│       ├── element-plus.ts
│       └── naive.ts
└── types/           # 类型定义
    └── index.ts
```

---

## 📊 项目阶段规划

### ✅ 第一阶段：基础重构（已完成）
**时间**: 2026-02-08 ~ 2026-02-10

**目标**: 建立项目基础架构

**完成项**:
- ✅ Monorepo 包结构重组
- ✅ 组件重命名（CanvasTable → CTable）
- ✅ 类型系统扩展（兼容 Ant Design Vue）
- ✅ 主题系统重构（6 种预设主题）
- ✅ 虚拟滚动核心问题修复
- ✅ 内存泄漏问题修复
- ✅ 渲染性能优化（增量更新）

**成果**:
- 📦 独立的 npm 包 `@catui/ctable`
- 🎨 6 种主题预设
- ⚡ 渲染性能提升 70%
- 🧹 内存泄漏修复
- 📚 完整的代码规范和文档

---

### 🔄 第二阶段：功能完善（进行中）
**时间**: 2026-02-11 ~ 2026-02-24

**目标**: 完善核心功能，提升用户体验

**任务列表**:

#### 高优先级 🔴
1. **固定列功能**
   - [ ] 左侧固定列
   - [ ] 右侧固定列
   - [ ] 固定列阴影效果

2. **交互优化**
   - [ ] 单元格 hover 高亮边框 ✅ (已完成 2026-02-11)
   - [ ] 单元格点击选择
   - [ ] 单元格区域选择（Range Selection）
   - [ ] 键盘导航支持

3. **G2 深度集成**
   - [ ] 重写 G2TableRenderer 使用 G2 Mark/View API
   - [ ] 实现声明式渲染
   - [ ] 图表集成能力

#### 中优先级 🟡
4. **API 完全兼容**
   - [ ] 完善 CTableProps 与 a-table 的兼容性
   - [ ] 添加缺失的 props
   - [ ] 事件参数格式对齐

5. **单元测试**
   - [ ] 核心模块测试（覆盖率目标 80%）
   - [ ] 组件测试
   - [ ] E2E 测试

6. **文档完善**
   - [ ] API 文档
   - [ ] 示例代码
   - [ ] 最佳实践指南

#### 低优先级 🟢
7. **性能优化**
   - [ ] 大数据量测试（100 万行）
   - [ ] 性能监控工具
   - [ ] 渲染优化

8. **开发工具**
   - [ ] Storybook 集成
   - [ ] 性能分析面板
   - [ ] 调试工具

---

### 📅 第三阶段：高级功能（规划中）
**时间**: 2026-02-25 ~ 2026-03-15

**目标**: 实现高级功能，打造差异化竞争力

**功能规划**:
1. 单元格编辑（行内编辑、弹窗编辑）
2. 拖拽排序（行拖拽、列拖拽）
3. 虚拟树形表格（百万级树节点）
4. 数据导出（Excel、CSV）
5. 打印功能
6. 自定义渲染器插件系统

---

### 🚀 第四阶段：发布与推广（规划中）
**时间**: 2026-03-16 ~ 2026-03-31

**目标**: 正式发布，建立社区

**任务**:
1. 代码审查与优化
2. 性能基准测试
3. 官网建设
4. 发布到 npm
5. 社区运营

---

## 🔧 技术债务与待解决问题

### 已知问题
1. **G2 集成不完整** - 当前只使用了基础 Canvas API，未使用 G2 的声明式能力
2. **单元测试缺失** - 测试覆盖率仅 10%
3. **性能基准缺失** - 需要建立性能监控体系

### 技术债务
1. **双渲染器维护** - G2TableRenderer 和 G2TableRendererV2 需要统一
2. **类型定义分散** - 部分类型定义在多个文件中重复
3. **文档不完整** - API 文档和示例代码缺失

---

## 📈 成功指标

### 技术指标
- [ ] 支持 100 万行数据流畅滚动
- [ ] 单元测试覆盖率 ≥ 80%
- [ ] 渲染性能 ≤ 100ms (万行数据)
- [ ] 内存占用 ≤ 100MB

### 业务指标
- [ ] npm 周下载量 ≥ 1000
- [ ] GitHub Stars ≥ 100
- [ ] 社区贡献者 ≥ 5

### 用户体验指标
- [ ] API 学习成本 ≤ 30 分钟
- [ ] 首次渲染时间 ≤ 500ms
- [ ] 滚动帧率稳定在 60 FPS

---

## 🚨 风险与挑战

### 技术风险
1. **G2 API 稳定性** - G2 5.x 仍在快速迭代，API 可能变化
2. **性能优化极限** - 超大数据量下的性能瓶颈
3. **浏览器兼容性** - Canvas 在不同浏览器的性能差异

### 资源风险
1. **开发人力** - 当前主要由 AI 辅助开发，需要代码审查
2. **测试资源** - 缺少专业测试人员
3. **文档维护** - 文档更新需要持续投入

---

## 📚 相关文档

- [项目任务跟踪](./10-about/project-tasks.md)
- [代码规范](./06-development/coding-standards.md)
- [开发指南](./06-development/)
- [架构设计](./05-architecture/design-doc.md)
- [G2 集成进度](./10-about/g2-integration.md)
- [测试报告](./10-about/test-report.md)

---

**维护者**: CatUI 开发团队
**最后更新**: 2026-02-11
