"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.findFieldCondition = exports.getIntervalScale = exports.getIconPosition = void 0;
const lodash_1 = require("lodash");
const formatter_1 = require("../formatter");
const getIconPosition = (condition) => { var _a; return (_a = condition === null || condition === void 0 ? void 0 : condition.position) !== null && _a !== void 0 ? _a : 'right'; };
exports.getIconPosition = getIconPosition;
/*
 * 生成柱状图的的绘制范围，柱状图的生成逻辑都是统一的负左正右的逻辑
 * 分为以下几种情况：
 * 1. maxValue > minValue >=0，柱状图从最左侧开始绘制，范围是 min -- max， 可以认为 0 点此时和 min 重合
 * 0 min                      max
 * | |                        |
 * | +------------------------+
 * | |▉▉▉▉▉▉▉                 |
 * | +------------------------+
 * 2. maxValue > 0 > minValue，柱状图从0点开始绘制，范围是 min -- 0 --  max
 * min          0            max
 *  |           |            |
 *  +-----------|------------+
 *  |    ▉▉▉▉▉▉▉|▉▉▉▉        |
 *  +-----------|------------+
 * 3. 0 >= maxValue > minValue，柱状图从最右侧开始绘制，范围是 min -- max，可以认为 0 点此时和 max 重合
 * min                      max 0
 *  |                        |  |
 *  +------------------------+  |
 *  |             ▉▉▉▉▉▉▉▉▉▉▉|  |
 *  +------------------------+  |
 */
const getIntervalScale = (minValue = 0, maxValue = 0) => {
    minValue = (0, formatter_1.parseNumberWithPrecision)(minValue);
    maxValue = (0, formatter_1.parseNumberWithPrecision)(maxValue);
    // 处理所有值相等的情况
    if (minValue === maxValue) {
        return () => ({
            zeroScale: 0,
            scale: 0,
        });
    }
    const allPositiveValue = minValue >= 0;
    const bothPositiveAndNegativeValue = maxValue >= 0 && minValue <= 0;
    const zeroForEitherPositiveOrNegative = allPositiveValue
        ? minValue
        : maxValue;
    const zero = bothPositiveAndNegativeValue
        ? 0
        : zeroForEitherPositiveOrNegative;
    const distance = maxValue - minValue;
    return (current) => {
        const zeroScaleForEitherPositiveOrNegative = allPositiveValue ? 0 : 1;
        const zeroScale = bothPositiveAndNegativeValue
            ? (0, lodash_1.clamp)(Math.abs(0 - minValue) / distance, 0, 1)
            : zeroScaleForEitherPositiveOrNegative;
        // scale 为负值时，代表方向绘制（g支持的模式）
        const scale = (0, lodash_1.clamp)((current - zero) / distance, -1, 1);
        return { zeroScale, scale };
    };
};
exports.getIntervalScale = getIntervalScale;
const findFieldCondition = (conditions = [], field) => {
    return (0, lodash_1.findLast)((0, lodash_1.compact)(conditions), (item) => {
        return item.field instanceof RegExp
            ? item.field.test(field)
            : item.field === field;
    });
};
exports.findFieldCondition = findFieldCondition;
//# sourceMappingURL=condition.js.map