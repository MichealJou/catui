{"version":3,"file":"pivot-sheet.vue2.js","sources":["../../../src/components/sheets/pivot-sheet.vue"],"sourcesContent":["<script lang=\"ts\">\nimport {\n  type S2Options,\n  buildDrillDownOptions,\n  handleDrillDown,\n  type ActionIconCallbackParams,\n  type PartDrillDown,\n} from '@antv/s2';\nimport { isEmpty } from 'lodash';\nimport { computed, createVNode, defineComponent, ref, toRefs } from 'vue';\nimport { useExpose } from '../../hooks/useExpose';\nimport type { BaseSheetInitEmits } from '../../interface';\nimport { initBaseSheetProps } from '../../utils/initPropAndEmits';\nimport DrillDown from '../drill-down/index.vue';\nimport BaseSheet from './base-sheet.vue';\n\nexport default defineComponent({\n  name: 'PivotSheet',\n  props: initBaseSheetProps(),\n  emits: [] as unknown as BaseSheetInitEmits,\n  setup(props, ctx) {\n    const s2Ref = useExpose(ctx.expose);\n    const { options: pivotOptions } = toRefs(props);\n    const { dataCfg, partDrillDown } = toRefs(props);\n    // 被下钻的 field\n    const drillFields = ref<string[]>([]);\n\n    // 执行下钻操作\n    const setDrillFields = (fields: string[]) => {\n      const instance = s2Ref?.value?.instance;\n\n      drillFields.value = fields;\n      instance?.hideTooltip();\n      if (isEmpty(fields)) {\n        instance?.clearDrillDownData(instance?.store.get('drillDownNode')?.id);\n      } else {\n        // 执行下钻\n        handleDrillDown({\n          rows: (dataCfg.value?.fields.rows as string[]) ?? [],\n          drillFields: fields,\n          fetchData: partDrillDown.value?.['fetchData'],\n          drillItemsNum: partDrillDown.value?.['drillItemsNum'],\n          spreadsheet: instance,\n        });\n      }\n    };\n\n    /**\n     * 点击下钻后，下钻组件的出现\n     */\n    const onDrillDownIconClick = (params: ActionIconCallbackParams) => {\n      const { event, disabledFields } = params;\n\n      if (event) {\n        const instance = s2Ref?.value?.instance;\n        const drillDownNode = createVNode(DrillDown, {\n          ...partDrillDown.value?.['drillConfig'],\n          setDrillFields,\n          drillFields: drillFields.value,\n          disabledFields,\n        });\n\n        // 将下钻设置为 tooltip 的 content 进行展示\n        instance?.showTooltip({\n          position: {\n            x: event.clientX,\n            y: event.clientY,\n          },\n          event,\n          content: drillDownNode,\n        });\n      }\n    };\n\n    // 展示下钻icon\n    const options = computed(() =>\n      buildDrillDownOptions(\n        pivotOptions.value as any,\n        partDrillDown.value as PartDrillDown,\n        (params) => onDrillDownIconClick(params),\n      ),\n    ) as S2Options;\n\n    return {\n      s2Ref,\n      options,\n    };\n  },\n  components: {\n    BaseSheet,\n  },\n});\n</script>\n\n<template>\n  <BaseSheet v-bind=\"$props\" ref=\"s2Ref\" :options=\"options\" />\n</template>\n"],"names":["defineComponent","initBaseSheetProps","useExpose","toRefs","ref","isEmpty","handleDrillDown","createVNode","DrillDown","computed","buildDrillDownOptions","BaseSheet"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,MAAA,YAAeA,oBAAgB;AAAA,EAC7B,MAAM;AAAA,EACN,OAAOC,iBAAAA,mBAAA;AAAA,EACP,OAAO,CAAA;AAAA,EACP,MAAM,OAAO,KAAK;AAChB,UAAM,QAAQC,UAAAA,UAAU,IAAI,MAAM;AAClC,UAAM,EAAE,SAAS,iBAAiBC,IAAAA,OAAO,KAAK;AAC9C,UAAM,EAAE,SAAS,kBAAkBA,IAAAA,OAAO,KAAK;AAE/C,UAAM,cAAcC,IAAAA,IAAc,EAAE;AAGpC,UAAM,iBAAiB,CAAC,WAAqB;;AAC3C,YAAM,YAAW,oCAAO,UAAP,mBAAc;AAE/B,kBAAY,QAAQ;AACpB,2CAAU;AACV,UAAIC,OAAAA,QAAQ,MAAM,GAAG;AACnB,6CAAU,oBAAmB,0CAAU,MAAM,IAAI,qBAApB,mBAAsC;AAAA,MACrE,OAAO;AAELC,2BAAgB;AAAA,UACd,OAAO,mBAAQ,UAAR,mBAAe,OAAO,SAAtB,YAA2C,CAAA;AAAA,UAClD,aAAa;AAAA,UACb,YAAW,mBAAc,UAAd,mBAAsB;AAAA,UACjC,gBAAe,mBAAc,UAAd,mBAAsB;AAAA,UACrC,aAAa;AAAA,QAAA,CACd;AAAA,MACH;AAAA,IACF;AAKA,UAAM,uBAAuB,CAAC,WAAqC;;AACjE,YAAM,EAAE,OAAO,eAAA,IAAmB;AAElC,UAAI,OAAO;AACT,cAAM,YAAW,oCAAO,UAAP,mBAAc;AAC/B,cAAM,gBAAgBC,IAAAA,YAAYC,OAAW,kCACxC,mBAAc,UAAd,mBAAsB,iBADkB;AAAA,UAE3C;AAAA,UACA,aAAa,YAAY;AAAA,UACzB;AAAA,QAAA,EACD;AAGD,6CAAU,YAAY;AAAA,UACpB,UAAU;AAAA,YACR,GAAG,MAAM;AAAA,YACT,GAAG,MAAM;AAAA,UAAA;AAAA,UAEX;AAAA,UACA,SAAS;AAAA,QAAA;AAAA,MAEb;AAAA,IACF;AAGA,UAAM,UAAUC,IAAAA;AAAAA,MAAS,MACvBC,GAAAA;AAAAA,QACE,aAAa;AAAA,QACb,cAAc;AAAA,QACd,CAAC,WAAW,qBAAqB,MAAM;AAAA,MAAA;AAAA,IACzC;AAGF,WAAO;AAAA,MACL;AAAA,MACA;AAAA,IAAA;AAAA,EAEJ;AAAA,EACA,YAAY;AAAA,IAAA,WACVC;AAAAA,EAAA;AAEJ,CAAC;;"}