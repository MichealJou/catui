{"version":3,"file":"useSpreadSheet.js","sources":["../../src/hooks/useSpreadSheet.ts"],"sourcesContent":["import {\n  PivotSheet,\n  TableSheet,\n  type S2Options,\n  type SpreadSheet,\n} from '@antv/s2';\nimport { PivotChartSheet } from '@antv/s2/extends';\nimport { onBeforeUnmount, onMounted, ref, shallowRef, toRaw, toRef } from 'vue';\nimport type { BaseSheetInitEmits, EmitFn } from '../interface';\nimport type { BaseSheetProps } from '../utils/initPropAndEmits';\nimport { getSheetComponentOptions } from '../utils/options';\nimport { useEvents } from './useEvents';\nimport { useLoading } from './useLoading';\nimport { usePagination } from './usePagination';\nimport { useResize } from './useResize';\nimport { useSheetUpdate } from './useSheetUpdate';\n\nexport function useSpreadSheet(\n  props: BaseSheetProps,\n  emit: EmitFn<BaseSheetInitEmits>,\n) {\n  const {\n    dataCfg,\n    options,\n    themeCfg,\n    sheetType,\n    spreadsheet: customSpreadSheet,\n    onMounted: onS2Mounted,\n  } = props;\n\n  // 使用 toRef 保持 loading 属性的响应性\n  const loadingRef = toRef(props, 'loading');\n\n  const wrapperRef = ref<HTMLDivElement>();\n  const containerRef = ref<HTMLDivElement>();\n\n  const s2Ref = shallowRef<SpreadSheet>();\n\n  const { loading, setLoading } = useLoading(s2Ref, loadingRef);\n  const pagination = usePagination(s2Ref, props);\n\n  const renderSpreadSheet = (container: HTMLDivElement) => {\n    const rawDataCfg = toRaw(dataCfg!);\n    const rawOptions = toRaw(options);\n\n    const s2Options = getSheetComponentOptions(rawOptions as S2Options);\n\n    if (customSpreadSheet) {\n      return customSpreadSheet(container, rawDataCfg, s2Options);\n    }\n\n    if (sheetType === 'table' || sheetType === 'editable') {\n      return new TableSheet(container, rawDataCfg, s2Options);\n    }\n\n    if (sheetType === 'pivotChart') {\n      return new PivotChartSheet(container, rawDataCfg, s2Options);\n    }\n\n    return new PivotSheet(container, rawDataCfg, s2Options);\n  };\n\n  const buildSpreadSheet = async () => {\n    setLoading(true);\n    s2Ref.value = renderSpreadSheet(containerRef.value!);\n    s2Ref.value.setThemeCfg(toRaw(themeCfg));\n    await s2Ref.value.render();\n\n    setLoading(false);\n    onS2Mounted?.(s2Ref.value);\n  };\n\n  onMounted(buildSpreadSheet);\n  useEvents(s2Ref, emit);\n  useSheetUpdate(s2Ref, props, {\n    before() {\n      setLoading(true);\n    },\n    after() {\n      setLoading(false);\n    },\n  });\n  useResize(s2Ref, props, { wrapperRef, containerRef });\n\n  onBeforeUnmount(() => {\n    setLoading(false);\n    s2Ref.value?.destroy();\n  });\n\n  return {\n    wrapperRef,\n    containerRef,\n    s2Ref,\n    loading,\n    setLoading,\n    pagination,\n  };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBO,SAAS,eACd,OACA,MACA;AACA,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,aAAa;AAAA,IACb,WAAW;AAAA,EAAA,IACT;AAGJ,QAAM,aAAa,MAAM,OAAO,SAAS;AAEzC,QAAM,aAAa,IAAA;AACnB,QAAM,eAAe,IAAA;AAErB,QAAM,QAAQ,WAAA;AAEd,QAAM,EAAE,SAAS,WAAA,IAAe,WAAW,OAAO,UAAU;AAC5D,QAAM,aAAa,cAAc,OAAO,KAAK;AAE7C,QAAM,oBAAoB,CAAC,cAA8B;AACvD,UAAM,aAAa,MAAM,OAAQ;AACjC,UAAM,aAAa,MAAM,OAAO;AAEhC,UAAM,YAAY,yBAAyB,UAAuB;AAElE,QAAI,mBAAmB;AACrB,aAAO,kBAAkB,WAAW,YAAY,SAAS;AAAA,IAC3D;AAEA,QAAI,cAAc,WAAW,cAAc,YAAY;AACrD,aAAO,IAAI,WAAW,WAAW,YAAY,SAAS;AAAA,IACxD;AAEA,QAAI,cAAc,cAAc;AAC9B,aAAO,IAAI,gBAAgB,WAAW,YAAY,SAAS;AAAA,IAC7D;AAEA,WAAO,IAAI,WAAW,WAAW,YAAY,SAAS;AAAA,EACxD;AAEA,QAAM,mBAAmB,MAAY;AACnC,eAAW,IAAI;AACf,UAAM,QAAQ,kBAAkB,aAAa,KAAM;AACnD,UAAM,MAAM,YAAY,MAAM,QAAQ,CAAC;AACvC,UAAM,MAAM,MAAM,OAAA;AAElB,eAAW,KAAK;AAChB,+CAAc,MAAM;AAAA,EACtB;AAEA,YAAU,gBAAgB;AAC1B,YAAU,OAAO,IAAI;AACrB,iBAAe,OAAO,OAAO;AAAA,IAC3B,SAAS;AACP,iBAAW,IAAI;AAAA,IACjB;AAAA,IACA,QAAQ;AACN,iBAAW,KAAK;AAAA,IAClB;AAAA,EAAA,CACD;AACD,YAAU,OAAO,OAAO,EAAE,YAAY,cAAc;AAEpD,kBAAgB,MAAM;;AACpB,eAAW,KAAK;AAChB,gBAAM,UAAN,mBAAa;AAAA,EACf,CAAC;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;"}