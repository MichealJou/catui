{"version":3,"file":"usePagination.js","sources":["../../src/hooks/usePagination.ts"],"sourcesContent":["import {\n  S2Event,\n  type EmitterType,\n  type Pagination,\n  type SpreadSheet,\n} from '@antv/s2';\nimport { isEmpty, omit } from 'lodash';\nimport { computed, ref, watch, type Ref } from 'vue';\nimport type { BaseSheetProps } from '../utils/initPropAndEmits';\n\nexport const DEFAULT_PAGE_NUMBER = 1;\nexport const DEFAULT_PAGE_SIZE = 10;\n\nexport const usePagination = (\n  s2Ref: Ref<SpreadSheet | undefined>,\n  props: BaseSheetProps,\n) => {\n  const {\n    options: { pagination: paginationCfg },\n    showPagination,\n  } = props;\n  const current = ref(paginationCfg?.current ?? DEFAULT_PAGE_NUMBER);\n  const pageSize = ref(paginationCfg?.pageSize ?? DEFAULT_PAGE_SIZE);\n  const total = ref(0);\n\n  const change = (nextCurrent: number) => {\n    current.value = nextCurrent;\n  };\n\n  const showSizeChange = (nextPageSize: number) => {\n    pageSize.value = nextPageSize;\n  };\n\n  const visible = computed(() => {\n    return showPagination && !isEmpty(paginationCfg);\n  });\n\n  // sync state.pagination -> s2.pagination\n  watch([current, pageSize], async () => {\n    if (!s2Ref.value) {\n      return;\n    }\n\n    const nextPagination = isEmpty(paginationCfg)\n      ? (null as unknown as Pagination)\n      : {\n          current: current.value,\n          pageSize: pageSize.value,\n        };\n\n    s2Ref.value.updatePagination(nextPagination);\n    await s2Ref.value.render(false);\n  });\n\n  // sync props.pagination -> state.pagination\n  watch(\n    [() => paginationCfg, s2Ref],\n    () => {\n      current.value = paginationCfg?.current ?? DEFAULT_PAGE_NUMBER;\n      pageSize.value = paginationCfg?.pageSize ?? DEFAULT_PAGE_SIZE;\n      total.value = s2Ref.value?.facet?.viewCellHeights.getTotalLength() ?? 0;\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  // sync layout result total -> state.total\n  watch(s2Ref, (value, oldValue, onCleanup) => {\n    if (!s2Ref.value) {\n      return;\n    }\n\n    const totalUpdateCallback: EmitterType[S2Event.LAYOUT_PAGINATION] = (\n      data,\n    ) => {\n      if (isEmpty(paginationCfg)) {\n        return;\n      }\n\n      total.value = data.total;\n    };\n\n    s2Ref.value.on(S2Event.LAYOUT_PAGINATION, totalUpdateCallback);\n\n    onCleanup(() => {\n      s2Ref.value?.off(S2Event.LAYOUT_PAGINATION, totalUpdateCallback);\n    });\n  });\n\n  return {\n    customOptions: omit(paginationCfg, ['current', 'pageSize', 'total']),\n    visible,\n    current,\n    pageSize,\n    total,\n    change,\n    showSizeChange,\n  };\n};\n"],"names":["_a","_b"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAUO,MAAM,sBAAsB;AAC5B,MAAM,oBAAoB;AAE1B,MAAM,gBAAgB,CAC3B,OACA,UACG;;AACH,QAAM;AAAA,IACJ,SAAS,EAAE,YAAY,cAAA;AAAA,IACvB;AAAA,EAAA,IACE;AACJ,QAAM,UAAU,KAAI,oDAAe,YAAf,YAA0B,mBAAmB;AACjE,QAAM,WAAW,KAAI,oDAAe,aAAf,YAA2B,iBAAiB;AACjE,QAAM,QAAQ,IAAI,CAAC;AAEnB,QAAM,SAAS,CAAC,gBAAwB;AACtC,YAAQ,QAAQ;AAAA,EAClB;AAEA,QAAM,iBAAiB,CAAC,iBAAyB;AAC/C,aAAS,QAAQ;AAAA,EACnB;AAEA,QAAM,UAAU,SAAS,MAAM;AAC7B,WAAO,kBAAkB,CAAC,QAAQ,aAAa;AAAA,EACjD,CAAC;AAGD,QAAM,CAAC,SAAS,QAAQ,GAAG,MAAY;AACrC,QAAI,CAAC,MAAM,OAAO;AAChB;AAAA,IACF;AAEA,UAAM,iBAAiB,QAAQ,aAAa,IACvC,OACD;AAAA,MACE,SAAS,QAAQ;AAAA,MACjB,UAAU,SAAS;AAAA,IAAA;AAGzB,UAAM,MAAM,iBAAiB,cAAc;AAC3C,UAAM,MAAM,MAAM,OAAO,KAAK;AAAA,EAChC,EAAC;AAGD;AAAA,IACE,CAAC,MAAM,eAAe,KAAK;AAAA,IAC3B,MAAM;;AACJ,cAAQ,SAAQA,MAAA,+CAAe,YAAf,OAAAA,MAA0B;AAC1C,eAAS,SAAQC,MAAA,+CAAe,aAAf,OAAAA,MAA2B;AAC5C,YAAM,SAAQ,uBAAM,UAAN,mBAAa,UAAb,mBAAoB,gBAAgB,qBAApC,YAAwD;AAAA,IACxE;AAAA,IACA;AAAA,MACE,WAAW;AAAA,IAAA;AAAA,EACb;AAIF,QAAM,OAAO,CAAC,OAAO,UAAU,cAAc;AAC3C,QAAI,CAAC,MAAM,OAAO;AAChB;AAAA,IACF;AAEA,UAAM,sBAA8D,CAClE,SACG;AACH,UAAI,QAAQ,aAAa,GAAG;AAC1B;AAAA,MACF;AAEA,YAAM,QAAQ,KAAK;AAAA,IACrB;AAEA,UAAM,MAAM,GAAG,QAAQ,mBAAmB,mBAAmB;AAE7D,cAAU,MAAM;;AACd,OAAAD,MAAA,MAAM,UAAN,gBAAAA,IAAa,IAAI,QAAQ,mBAAmB;AAAA,IAC9C,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL,eAAe,KAAK,eAAe,CAAC,WAAW,YAAY,OAAO,CAAC;AAAA,IACnE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;"}