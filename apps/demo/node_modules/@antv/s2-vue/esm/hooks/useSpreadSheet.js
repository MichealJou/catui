var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};
import { TableSheet, PivotSheet } from "@antv/s2";
import { PivotChartSheet } from "@antv/s2/extends";
import { toRef, ref, shallowRef, onMounted, onBeforeUnmount, toRaw } from "vue";
import { getSheetComponentOptions } from "../utils/options.js";
import { useEvents } from "./useEvents.js";
import { useLoading } from "./useLoading.js";
import { usePagination } from "./usePagination.js";
import { useResize } from "./useResize.js";
import { useSheetUpdate } from "./useSheetUpdate.js";
function useSpreadSheet(props, emit) {
  const {
    dataCfg,
    options,
    themeCfg,
    sheetType,
    spreadsheet: customSpreadSheet,
    onMounted: onS2Mounted
  } = props;
  const loadingRef = toRef(props, "loading");
  const wrapperRef = ref();
  const containerRef = ref();
  const s2Ref = shallowRef();
  const { loading, setLoading } = useLoading(s2Ref, loadingRef);
  const pagination = usePagination(s2Ref, props);
  const renderSpreadSheet = (container) => {
    const rawDataCfg = toRaw(dataCfg);
    const rawOptions = toRaw(options);
    const s2Options = getSheetComponentOptions(rawOptions);
    if (customSpreadSheet) {
      return customSpreadSheet(container, rawDataCfg, s2Options);
    }
    if (sheetType === "table" || sheetType === "editable") {
      return new TableSheet(container, rawDataCfg, s2Options);
    }
    if (sheetType === "pivotChart") {
      return new PivotChartSheet(container, rawDataCfg, s2Options);
    }
    return new PivotSheet(container, rawDataCfg, s2Options);
  };
  const buildSpreadSheet = () => __async(this, null, function* () {
    setLoading(true);
    s2Ref.value = renderSpreadSheet(containerRef.value);
    s2Ref.value.setThemeCfg(toRaw(themeCfg));
    yield s2Ref.value.render();
    setLoading(false);
    onS2Mounted == null ? void 0 : onS2Mounted(s2Ref.value);
  });
  onMounted(buildSpreadSheet);
  useEvents(s2Ref, emit);
  useSheetUpdate(s2Ref, props, {
    before() {
      setLoading(true);
    },
    after() {
      setLoading(false);
    }
  });
  useResize(s2Ref, props, { wrapperRef, containerRef });
  onBeforeUnmount(() => {
    var _a;
    setLoading(false);
    (_a = s2Ref.value) == null ? void 0 : _a.destroy();
  });
  return {
    wrapperRef,
    containerRef,
    s2Ref,
    loading,
    setLoading,
    pagination
  };
}
export {
  useSpreadSheet
};
//# sourceMappingURL=useSpreadSheet.js.map
