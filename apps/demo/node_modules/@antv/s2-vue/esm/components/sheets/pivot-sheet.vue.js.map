{"version":3,"file":"pivot-sheet.vue.js","sources":["../../../src/components/sheets/pivot-sheet.vue"],"sourcesContent":["<script lang=\"ts\">\nimport {\n  type S2Options,\n  buildDrillDownOptions,\n  handleDrillDown,\n  type ActionIconCallbackParams,\n  type PartDrillDown,\n} from '@antv/s2';\nimport { isEmpty } from 'lodash';\nimport { computed, createVNode, defineComponent, ref, toRefs } from 'vue';\nimport { useExpose } from '../../hooks/useExpose';\nimport type { BaseSheetInitEmits } from '../../interface';\nimport { initBaseSheetProps } from '../../utils/initPropAndEmits';\nimport DrillDown from '../drill-down/index.vue';\nimport BaseSheet from './base-sheet.vue';\n\nexport default defineComponent({\n  name: 'PivotSheet',\n  props: initBaseSheetProps(),\n  emits: [] as unknown as BaseSheetInitEmits,\n  setup(props, ctx) {\n    const s2Ref = useExpose(ctx.expose);\n    const { options: pivotOptions } = toRefs(props);\n    const { dataCfg, partDrillDown } = toRefs(props);\n    // 被下钻的 field\n    const drillFields = ref<string[]>([]);\n\n    // 执行下钻操作\n    const setDrillFields = (fields: string[]) => {\n      const instance = s2Ref?.value?.instance;\n\n      drillFields.value = fields;\n      instance?.hideTooltip();\n      if (isEmpty(fields)) {\n        instance?.clearDrillDownData(instance?.store.get('drillDownNode')?.id);\n      } else {\n        // 执行下钻\n        handleDrillDown({\n          rows: (dataCfg.value?.fields.rows as string[]) ?? [],\n          drillFields: fields,\n          fetchData: partDrillDown.value?.['fetchData'],\n          drillItemsNum: partDrillDown.value?.['drillItemsNum'],\n          spreadsheet: instance,\n        });\n      }\n    };\n\n    /**\n     * 点击下钻后，下钻组件的出现\n     */\n    const onDrillDownIconClick = (params: ActionIconCallbackParams) => {\n      const { event, disabledFields } = params;\n\n      if (event) {\n        const instance = s2Ref?.value?.instance;\n        const drillDownNode = createVNode(DrillDown, {\n          ...partDrillDown.value?.['drillConfig'],\n          setDrillFields,\n          drillFields: drillFields.value,\n          disabledFields,\n        });\n\n        // 将下钻设置为 tooltip 的 content 进行展示\n        instance?.showTooltip({\n          position: {\n            x: event.clientX,\n            y: event.clientY,\n          },\n          event,\n          content: drillDownNode,\n        });\n      }\n    };\n\n    // 展示下钻icon\n    const options = computed(() =>\n      buildDrillDownOptions(\n        pivotOptions.value as any,\n        partDrillDown.value as PartDrillDown,\n        (params) => onDrillDownIconClick(params),\n      ),\n    ) as S2Options;\n\n    return {\n      s2Ref,\n      options,\n    };\n  },\n  components: {\n    BaseSheet,\n  },\n});\n</script>\n\n<template>\n  <BaseSheet v-bind=\"$props\" ref=\"s2Ref\" :options=\"options\" />\n</template>\n"],"names":["_resolveComponent","_openBlock","options","_mergeProps"],"mappings":";;;;AA+FE,QAAA,uBAAAA,iBAA4D,WAA5D;AAAwC,SAAAC,UAAA,GAASC,YAAO,sBAAAC,WAAA,KAAA,QAAA;AAAA,IAAA,KAAA;AAAA;;;;"}